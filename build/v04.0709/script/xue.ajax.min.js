/**
 * XESUI 
 * Copyright 2013 xueersi.com All rights reserved.
 *
 * @description 
 *
 * @author Marco (marco@xesui.com)
 * @modify 2013-06-26 21:41:15
 * @version $Id$
 * 
 * @links http://xesui.com
 */


/**
 * @name xue.ajax.js
 * @description 封装ajax公共方法
 * 
 * @module 
 * @submodule 
 * @main 
 * @class 
 * @constructor 
 * @static 
 */


module.ajax = module.ajax || function(expr, opt, fn){
	
	if(expr === undefined){
		return module.ajax;
	}
	
	var handle = expr ? $(expr) : $(document);

	var opt = (typeof opt === 'object' && opt.length === undefined) ? opt : false;



	// $.ajaxSetup({
	// 	timeout    : 7000,
	// 	beforeSend : function(a, b, c){
	// 		handle.html('<span class="ui_loading">Loading...</span>');
	// 	},
	// 	error      : function(a, b, c){
	// 		alert(c);
	// 	},
	// 	success    : function(){

	// 		console.log('success!!!');
	// 	},
	// 	complete   : function(){
	// 		// 清除掉loading
	// 		handle.find('.ui_loading').remove();
	// 	}
	// });

	var defult = {
		dataType : 'json',
		timeout  : 7000,
		beforeSend : function(a, b, c){
			handle.html('<span class="ui_loading">Loading...</span>');
		},
		error      : function(a, b, c){
			alert(c);
		},
		complete   : function(){
			handle.find('.ui_loading').remove();
		}
	};
	var options = {};

	$.extend(options, defult, opt);
	
	$.ajax(options);

	if(typeof fn === 'function'){
		handle.ajaxSuccess(function(d){
			return fn(d);
		});
	}
	

};

(function(){
	var ajax = module.ajax;

	ajax.loading = function(expr){
		var handle = expr ? $(expr) : $(document);
		handle.html('<span class="ui_loading">Loading...</span>');
	};

	ajax.loaded = function(expr){
		var handle = expr ? $(expr) : $(document);
		handle.find('.ui_loading').remove();
	};

})();

// // xue.ajax = xue.ajax || $.ajax || function( option ){};
// module.ajax = module.ajax || function( expr, opt ){ 

// 	module.dom = expr ? $(expr) : $(document);

// 	module.ajax.options = opt || false; 

// 	return $.ajax(opt); 
// };

// (function(){
// 	var ajax = module.ajax;

// 	var setLoading = function(dom){
// 		var dom = dom ? $(dom) : $('body');
// 		dom.html('<span class="ui_loading">Loading...</span>');
// 	};

// 	var delLoading = function(dom){
// 		var dom = dom ? $(dom) : $('body');
// 		dom.find('.ui_loading').remove();
// 	};

// 	var options = ajax.options || {
// 		timeout    : 7000,
// 		beforeSend : function(a, b, c){
// 			console.log(b);
// 			console.log('send.....');
// 		},
// 		error      : function(a, b, c){
// 			alert(c);
// 		},
// 		success    : function(){
// 			// 清除掉loading

// 			console.log('success!!!');
// 		},
// 		complete   : function(){
// 			// 清除掉loading
// 			console.log('complete');
// 		}

// 	};

// 	ajax.setup = function(opt){
// 		var opt = opt || options;

// 		$.ajaxSetup( opt );

// 		return this;
// 	};

// 	ajax.get = function(opt){

// 		return $.get(opt);
// 	};

// 	ajax.post = function(opt){
// 		return $.post(opt)
// 	};

// 	ajax.load = function(opt){
// 		return $.load(opt);
// 	};

// 	ajax.success = function(dom, opt){
// 		delLoading(dom);
// 		return $(dom).ajaxComplete(opt);
// 	};
// })();


xue.extend('ajax', module.ajax);

// xue.ajax.setup();

